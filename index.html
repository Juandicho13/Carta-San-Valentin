<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Entrega M√°gica para Mariana ü¶â</title>
    <style>
        /* --- FUENTES M√ÅGICAS --- */
        @import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Dancing+Script:wght@600&display=swap');
        
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: linear-gradient(135deg, #2b102f 0%, #1a0a1e 100%);
            font-family: 'Cinzel Decorative', serif;
            height: 100vh;
            /* Importante: hidden para que los elementos flotantes no creen scroll en el cuerpo */
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- CONTADOR --- */
        #counter-badge {
            position: absolute; top: 20px; right: 20px;
            background: rgba(43, 16, 47, 0.9); color: #d4af37;
            padding: 8px 20px; border-radius: 15px; font-size: 1rem;
            border: 2px solid #d4af37; box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
            z-index: 100;
        }

        /* --- SOBRE CERRADO --- */
        .envelope-wrapper {
            position: relative; width: 280px; height: 180px; cursor: pointer;
            transition: transform 0.3s; z-index: 50;
        }
        .envelope-wrapper:hover { transform: scale(1.05); }

        .envelope-body {
            position: absolute; bottom: 0; width: 100%; height: 100%;
            background-color: #dcbfa5; border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); overflow: hidden;
        }

        .flap { position: absolute; width: 0; height: 0; border-style: solid; }
        .flap-left { border-width: 90px 0 90px 140px; border-color: transparent transparent transparent #cbaea1; top: 0; left: 0; }
        .flap-right { border-width: 90px 140px 90px 0; border-color: transparent #cbaea1 transparent transparent; top: 0; right: 0; }
        .flap-bottom { border-width: 0 140px 100px 140px; border-color: transparent transparent #e6cfb9 transparent; bottom: 0; left: 0; z-index: 2; }
        .flap-top { border-width: 110px 140px 0 140px; border-color: #d4bcab transparent transparent transparent; top: 0; left: 0; z-index: 3; transform-origin: top; transition: transform 0.6s ease-in-out; }

        /* Sello Rojo del Sobre */
        .wax-seal-outer {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -80%);
            width: 45px; height: 45px; background: #8b0000; border-radius: 50%; z-index: 4;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 3px 5px rgba(0,0,0,0.3); border: 2px dashed #600000;
            color: #500000; font-size: 22px; font-weight: bold;
        }

        /* --- CARTA ABIERTA (CORREGIDO PARA M√ìVIL) --- */
        #letter-container {
            position: absolute; 
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 90%; 
            max-width: 550px;
            
            /* NUEVO: Altura m√°xima y scroll interno para que no se corte */
            max-height: 90vh; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; /* Scroll suave en iPhone */

            background-color: #f4e4bc;
            background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png');
            padding: 30px 25px;
            border: 4px double #8b4513; border-radius: 8px;
            box-shadow: 0 0 60px rgba(212, 175, 55, 0.5);
            z-index: 200; opacity: 0;
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #letter-container.open { transform: translate(-50%, -50%) scale(1); opacity: 1; }

        .letter-content h2 {
            font-family: 'Cinzel Decorative', serif; color: #5a3219;
            text-align: center; margin-bottom: 20px; font-size: 1.6rem;
            border-bottom: 2px solid #d4af37; padding-bottom: 10px;
        }

        .letter-content p {
            font-family: 'Dancing Script', cursive; font-size: 1.4rem;
            color: #3b2314; line-height: 1.5; margin-bottom: 15px;
            /* NUEVO: Texto justificado */
            text-align: justify;
        }

        /* Excepci√≥n para la pregunta principal y textos centrados */
        .letter-content p.centered-text {
            text-align: center;
        }

        .signature { text-align: right; font-size: 1.5rem; margin-top: 20px; font-weight: bold; color: #8b0000; }

        /* --- BOT√ìN S√ç --- */
        .botones-container {
            margin-top: 25px;
            display: flex;
            justify-content: center;
            padding-bottom: 10px; /* Espacio extra para el scroll */
        }

        .magical-btn {
            font-family: 'Cinzel Decorative', serif;
            padding: 12px 35px;
            font-size: 1.2rem;
            border: 3px solid #d4af37;
            background-color: #8b0000;
            color: #d4af37;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
            text-shadow: 1px 1px 2px #000;
            white-space: nowrap; /* Evita que el texto del bot√≥n se parta */
        }
        .magical-btn:active { transform: scale(0.95); }

        /* --- SELLO NEGRO FINAL Y ENLACE --- */
        .seal-link {
            text-decoration: none;
            display: block;
            width: fit-content;
            margin: 25px auto 10px auto;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent; /* Quita el parpadeo azul en m√≥viles */
        }
        .seal-link:hover .black-seal-final {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
        }

        .black-seal-final {
            width: 70px; height: 70px;
            background: #111; 
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: #d4af37; 
            font-family: 'Cinzel Decorative', serif;
            font-size: 35px;
            border: 3px dashed #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
            animation: popIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes popIn { from { transform: scale(0); opacity:0; } to { transform: scale(1); opacity: 1;} }

        /* --- T√çTULO PRINCIPAL Y ANIMACIONES --- */
        h1.main-title { 
            color: #edd59e; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); margin-top: 30px; font-size: 1.5rem; text-align: center; z-index: 10; 
            transition: opacity 0.5s ease; padding: 0 10px;
        }
        .title-hidden { opacity: 0; pointer-events: none; }

        .floater { position: absolute; font-size: 3rem; cursor: pointer; bottom: -80px; animation: floatUp linear forwards; z-index: 100; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); }
        @keyframes floatUp { to { transform: translateY(-120vh) rotate(20deg); } }
        .vanish { animation: fadeOut 0.5s forwards; }
        @keyframes fadeOut { to { opacity: 0; transform: scale(1.5); } }
    </style>
</head>
<body>

    <div id="counter-badge">Misi√≥n: Atrapa 3 lechuzas (0/3)</div>

    <div class="envelope-wrapper" id="closed-envelope">
        <div class="envelope-body">
            <div class="flap flap-left"></div><div class="flap flap-right"></div><div class="flap flap-bottom"></div><div class="flap flap-top" id="top-flap"></div>
            <div class="wax-seal-outer">H</div>
        </div>
    </div>

    <h1 class="main-title">¬øEsperas correspondencia importante? ‚ú®</h1>

    <div id="letter-container">
        <div class="letter-content" id="final-message-area">
            <h2>Entrega Especial por Correo Lechuza</h2>
            <p>Querida <strong>Mariana</strong>,</p>
            <p>Se requiere una habilidad m√°gica impresionante para interceptar estas cartas. ¬°Claramente eres una bruja talentosa!</p>
            <p>Ya que has atrapado el mensaje, tengo una pregunta muy importante que ni el Sombrero Seleccionador podr√≠a decidir por m√≠:</p>
            <p class="centered-text" style="font-size: 1.8rem; color: #8b0000; margin: 20px 0; font-family: 'Cinzel Decorative', serif;">¬øQuieres ser mi San Valent√≠n? ‚ù§Ô∏è</p>
            <p>Prometo que nuestra cita ser√° mejor que una cerveza de mantequilla en Las Tres Escobas.</p>
            <div class="signature">Con amor m√°gico,<br>Chiquitongo</div>

            <div class="botones-container">
                <button id="btn-si" class="magical-btn">¬°S√≠, acepto! ‚ú®</button>
            </div>
        </div>
    </div>

    <script>
        // --- L√ìGICA DEL JUEGO ---
        let score = 0; const targetScore = 3; let gameActive = true;
        const scoreDisplay = document.getElementById('counter-badge');
        const letterContainer = document.getElementById('letter-container');
        const closedEnvelope = document.getElementById('closed-envelope');

        function createFloater() {
            if (!gameActive) return;
            const floater = document.createElement('div'); floater.classList.add('floater');
            const emojis = ['ü¶â', '‚úâÔ∏è', '‚ú®', 'üìú']; floater.innerText = emojis[Math.floor(Math.random() * emojis.length)];
            floater.style.left = Math.random() * 85 + 5 + 'vw'; floater.style.animationDuration = Math.random() * 3 + 4 + 's';
            document.body.appendChild(floater);
            ['mousedown', 'touchstart'].forEach(evt => floater.addEventListener(evt, (e) => { e.preventDefault(); popFloater(floater); }, {once: true}));
            floater.addEventListener('animationend', () => floater.remove());
        }
        
        function popFloater(element) {
            if (!gameActive) return;
            element.style.transition = "all 0.2s"; element.style.transform = "scale(1.5)"; element.style.opacity = "0";
            setTimeout(() => element.remove(), 200);
            if (navigator.vibrate) navigator.vibrate(40);
            score++; scoreDisplay.innerText = `Misi√≥n: Atrapa 3 lechuzas (${score}/${targetScore})`;
            if (score >= targetScore) winGame();
        }
        
        function winGame() {
            gameActive = false; scoreDisplay.style.display = 'none';
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
            closedEnvelope.classList.add('vanish');
            setTimeout(() => { letterContainer.classList.add('open'); launchConfetti(); }, 300);
        }
        
        function launchConfetti() { for(let i=0; i<30; i++) setTimeout(createFloater, i * 100); }
        setInterval(createFloater, 800);

        // --- ACCI√ìN DEL BOT√ìN S√ç ---
        const btnSi = document.getElementById('btn-si');
        const messageArea = document.getElementById('final-message-area');
        const mainTitle = document.querySelector('.main-title');

        btnSi.addEventListener('click', () => {
            launchConfetti(); launchConfetti();
            if (navigator.vibrate) navigator.vibrate([50, 100, 50, 100]);

            // Oculta el t√≠tulo del fondo
            mainTitle.classList.add('title-hidden');

            // Muestra el mensaje final y el enlace hacia el itinerario
            messageArea.innerHTML = `
                <h2 style="color: #d4af37; border:none; font-size: 2.2rem;">¬°Cita Aceptada! ‚ú®</h2>
                <p class="centered-text" style="font-size: 1.6rem; margin-top: 25px;">
                    ¬°Sab√≠a que dir√≠as que s√≠! <br> Prep√°rate para la mejor cita m√°gica. ‚ù§Ô∏è
                </p>
                <p class="centered-text" style="font-size: 1.1rem; margin-top: 20px; color: #d4af37;">(Toca el sello para continuar)</p>

                <div class="seal-link" onclick="window.location.href='itinerario.html'">
                    <div class="black-seal-final">H</div>
                </div>
            `;
        });
    </script>
</body>
</html>